<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TODO List - using AdonisJS</title>

  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&amp;display=swap" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.standalone.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
  <style>
    body {
      font-family: "Open Sans", sans-serif;
      line-height: 1.6;
    }

    .add-todo-input,
    .edit-todo-input {
        outline: none;
    }

    .add-todo-input:focus,
    .edit-todo-input:focus {
        border: none !important;
        box-shadow: none !important;
    }

    .view-opt-label,
    .date-label {
        font-size: 0.8rem;
    }

    .edit-todo-input {
        font-size: 1.7rem !important;
    }

    .todo-actions {
        visibility: hidden !important;
    }

    .todo-item:hover .todo-actions {
        visibility: visible !important;
    }

    .todo-item.editing .todo-actions .edit-icon {
        display: none !important;
    }
  </style>
</head>
<body>
  @!section('todo')
</body>
<script>
  window.onload = function () {
    $('[data-toggle="tooltip"]').tooltip();

    function formatDate(date) {
        return (
            date.getDate() +
            "/" +
            (date.getMonth() + 1) +
            "/" +
            date.getFullYear()
        );
    }

    var currentDate = formatDate(new Date());

    $(".due-date-button").datepicker({
        format: "dd/mm/yyyy",
        autoclose: true,
        todayHighlight: true,
        startDate: currentDate,
        orientation: "bottom right"
    });

    $(".due-date-button").on("click", function (event) {
        $(".due-date-button")
            .datepicker("show")
            .on("changeDate", function (dateChangeEvent) {
                $(".due-date-button").datepicker("hide");
                $(".due-date-label").text(formatDate(dateChangeEvent.date));
            });
    });

    function getHiddenForm(options) {
      var form = document.createElement("form");
      form.setAttribute("action", options.url);
      form.setAttribute("method", 'post');
      return form;
    }

    $(".update-todo").on("click", function(evt) {
      evt.preventDefault()
      var todoId = $(this).parent().attr('data-id');
      var parent = $(this).parent().parent().parent();
      var task = $(parent).find('.edit-todo-input').val();
      var completed = $(parent).find('.update-todo').attr('data-value');
      var form = getHiddenForm({ url: `/todo/${todoId}?_method=PUT` });
      var is_completed = document.createElement("input");
      is_completed.setAttribute("type", "hidden");
      is_completed.setAttribute("name", "is_completed");
      is_completed.setAttribute("value", completed);
      form.appendChild(is_completed);
      document.body.appendChild(form);
      form.submit();
    })
    $(".delete-todo").on("click", function(evt) {
      evt.preventDefault()
      var todoId = $(this).parent().parent().attr('data-id');
      var form = getHiddenForm({ url: `/todo/${todoId}?_method=DELETE` });
      document.body.appendChild(form);
      form.submit();
    })
  };
</script>
</html>
